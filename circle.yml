general:
  artifacts:
    - "_book"
dependencies:
  cache_directories:
    - ~/calibre-bin
  post:
    - |
      if [ ! -e ~/calibre-bin/calibre/ebook-convert ]; then
        wget -nv -O- https://download.calibre-ebook.com/linux-installer.py | python -c "import sys; main=lambda x,y:sys.stderr.write('Download failed\n'); exec(sys.stdin.read()); main('~/calibre-bin', True)"
      fi
    - npm install
test:
  override:
    - ln -s ~/calibre-bin/calibre/ebook-convert node_modules/.bin/ebook-convert
    - npm run build

